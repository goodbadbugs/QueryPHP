
# Set script directory
scriptDir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd)
cd $scriptDir
cd ../../
git submodule init
git submodule update

onCent=0;
onUbuntu=0;
if  [[ os=$( cat /etc/os-release ) == *"CentOS"* ]]
then
	
	sudo yum -y reinstall php php-mysql httpd mysql-server mariadb-server
	echo 'you have cent'
	onCent=1;
elif [[ os=$( cat /etc/os-release ) == *"ubuntu"* ]]
then
	echo 'You have Ubuntu'
	onUbuntu=1;
	sudo apt-get -y install --reinstall apache2 mysql-server libapache2-mod-auth-mysql php5-mysql php5
fi

if [[ -d '/var/lib/mysql' ]]
then
	sudo rm -r /var/lib/mysql/*
fi

# If apache html directory does not exist, create it
sudo mkdir -p '/var/www/html'
cd $scriptDir
cd '../../public'
./setup


# Copy the httpd.conf to the appropriate directory
if [ onCent ]
then
	sudo cp /var/www/html/config/httpd.conf /etc/httpd/conf/
elif [ onUbuntu ]
then
	sudo cp /var/www/html/config/apache2.conf /etc/apache2/apache2/conf/
	sudo cp /var/www/html/config/site-config.conf /etc/apache2/sites-enabled/000-default.conf
fi

echo "Access your site's main page to setup the admin account";

./restartServ

# Make the database and permissions
mysql -u root < '/var/www/html/MySQL_Scripts/makeDB.sql'

./restartServ

# Set the owner of the web directory and its subdirectories to apache user
sudo chown -R apache:apache /var/www

echo 'The default password for MySQL root account has been set to "strawberryphp". Please log in to change the root password.';
